
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TPL Programs">
    
    <!-- SEO Meta Tags -->
    <title>Toronto Public Library Programs Calendar | Find Library Events & Activities</title>
    <meta name="description" content="Discover and explore Toronto Public Library programs, events, and activities. Search by location, date, category, and age group. Free library programs for all ages across Toronto.">
    <meta name="keywords" content="Toronto Public Library, library programs, library events, Toronto library activities, free library programs, library calendar, Toronto library schedule, library workshops, library classes">
    <meta name="author" content="Toronto Public Library">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="Toronto Public Library Programs Calendar">
    <meta property="og:description" content="Discover and explore Toronto Public Library programs, events, and activities. Search by location, date, category, and age group.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://your-domain.com">
    <meta property="og:image" content="https://your-domain.com/images/library-programs-og.jpg">
    <meta property="og:site_name" content="Toronto Public Library Programs Calendar">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Toronto Public Library Programs Calendar">
    <meta name="twitter:description" content="Discover and explore Toronto Public Library programs, events, and activities.">
    <meta name="twitter:image" content="https://your-domain.com/images/library-programs-twitter.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://tplevents.ca">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Toronto Public Library Programs Calendar",
        "description": "Discover and explore Toronto Public Library programs, events, and activities. Search by location, date, category, and age group.",
        "url": "https://tplevents.ca",
        "applicationCategory": "EntertainmentApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CAD"
        },
        "provider": {
            "@type": "Organization",
            "name": "Toronto Public Library",
            "url": "https://www.torontopubliclibrary.ca"
        },
        "audience": {
            "@type": "Audience",
            "audienceType": "All ages"
        }
    }
    </script>
    
    <!-- Performance hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    
    <!-- External CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/app.css">
    
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" role="navigation" aria-label="Main navigation">
        <div class="container-fluid">
            <a class="navbar-brand" href="/" aria-label="Toronto Public Library Programs Calendar Home">
                <i class="fas fa-calendar-alt me-2" aria-hidden="true"></i>
                Toronto Public Library Programs Calendar
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3" id="eventCount" aria-live="polite">
                    <i class="fas fa-clock me-1" aria-hidden="true"></i>
                    Loading programs...
                </span>
                <span class="navbar-text me-3" id="locationStatus" aria-live="polite">
                    <i class="fas fa-map-marker-alt me-1" aria-hidden="true"></i>
                    <span id="locationStatusText">Location not set</span>
                </span>
                <a href="#" class="contact-link" data-bs-toggle="modal" data-bs-target="#contactModal" aria-label="Contact us for feedback">
                    <i class="fas fa-envelope me-1" aria-hidden="true"></i>
                    <span class="d-none d-md-inline">Feedback</span>
                </a>
            </div>
        </div>
    </nav>

    <main id="main-content" class="container-fluid main-container" role="main">
        <h1 class="sr-only">Toronto Public Library Programs Calendar</h1>
        
        <!-- Website Description Section -->
        <div class="description-section">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h2 class="description-title">
                        <i class="fas fa-calendar-alt me-3"></i>
                        Discover & Plan Your Library Activities
                    </h2>
                    <p class="description-text">
                        Use the Toronto Public Library Programs Calendar to quickly find events, track what’s new, and plan visits that fit your schedule—whether you prefer a calendar view or the interactive map.
                    </p>
                    <div class="description-features">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="feature-item">
                                    <i class="fas fa-calendar-week feature-icon"></i>
                                    <h4>Calendar View</h4>
                                    <p>Browse programs in a monthly calendar format for easy weekly planning</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="feature-item">
                                    <i class="fas fa-map-marked-alt feature-icon"></i>
                                    <h4>Interactive Map</h4>
                                    <p>Find library locations and see how far they are from your current location</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="feature-item">
                                    <i class="fas fa-search feature-icon"></i>
                                    <h4>Smart Filtering</h4>
                                    <p>Filter by library, category, age group, and distance to find exactly what you need</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar" id="statusBar" style="display: none;">
            <div class="status-item">
                <i class="fas fa-calendar me-1"></i>
                <strong id="totalEvents">0</strong> total programs
            </div>
            <div class="status-item">
                <i class="fas fa-filter me-1"></i>
                <strong id="filteredEvents">0</strong> showing
            </div>
            <div class="status-item">
                <i class="fas fa-map-marker-alt me-1"></i>
                <strong id="libraryCount">0</strong> libraries
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
            <div class="filter-title">
                <i class="fas fa-filter"></i>
                Search & Filter Programs
            </div>
            <div class="row">
                <div class="col-md-12 col-lg-3 mb-3">
                    <label class="form-label">Search Programs</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search programs...">
                </div>
                <div class="col-md-6 col-lg-3 mb-3">
                    <label class="form-label mb-2">Library</label>
                    <div class="filter-group">
                        <input type="checkbox" id="libraryFilterToggle" class="filter-toggle" />
                        <label for="libraryFilterToggle" class="filter-header">
                            <span>Select Libraries</span>
                        </label>
                        <div class="filter-body" id="libraryFilterBody">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-3">
                    <label class="form-label mb-2">Age Group</label>
                    <div class="filter-group">
                        <input type="checkbox" id="ageGroupFilterToggle" class="filter-toggle" />
                        <label for="ageGroupFilterToggle" class="filter-header">
                            <span>Select Age Groups</span>
                        </label>
                        <div class="filter-body" id="ageGroupFilterBody">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3 mb-3">
                    <label class="form-label mb-2">Category</label>
                    <div class="filter-group">
                        <input type="checkbox" id="categoryFilterToggle" class="filter-toggle" />
                        <label for="categoryFilterToggle" class="filter-header">
                            <span>Select Categories</span>
                        </label>
                        <div class="filter-body" id="categoryFilterBody">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-2 mb-3">
                    <label class="form-label">Distance</label>
                    <select class="form-select" id="distanceFilter">
                        <option value="">Any Distance</option>
                        <option value="5">Within 5 km</option>
                        <option value="10">Within 10 km</option>
                        <option value="20">Within 20 km</option>
                        <option value="50">Within 50 km</option>
                    </select>
                </div>
                <div class="col-md-6 col-lg-2 mb-3">
                    <label class="form-label">&nbsp;</label>
                    <button class="btn btn-outline-secondary w-100" id="clearFilters">
                        <i class="fas fa-times me-1"></i>
                        Clear Filters
                    </button>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-12">
                    <div id="activeFiltersDisplay" class="active-filters-display">
                        <small class="text-muted">No filters selected</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <div class="btn-group" role="group" id="viewToggle">
                <input type="radio" class="btn-check" name="view" id="calendarView" value="calendar" checked>
                <label class="btn btn-outline-primary" for="calendarView">
                    <i class="fas fa-calendar me-1"></i>
                    Calendar
                </label>
                <input type="radio" class="btn-check" name="view" id="mapView" value="map">
                <label class="btn btn-outline-primary" for="mapView">
                    <i class="fas fa-map me-1"></i>
                    Map
                </label>
                <input type="radio" class="btn-check" name="view" id="newProgramsView" value="new">
                <label class="btn btn-outline-primary" for="newProgramsView">
                    <i class="fas fa-star me-1"></i>
                    New Programs
                </label>
            </div>
        </div>

        <!-- Calendar View -->
        <div id="calendarContainer">
            <!-- Calendar Navigation -->
            <div class="calendar-nav">
                <div class="nav-buttons">
                    <button class="btn btn-outline-primary" id="prevMonth">
                        <i class="fas fa-chevron-left"></i>
                        Previous
                    </button>
                    <button class="btn btn-primary" id="todayBtn">
                        <i class="fas fa-calendar-day"></i>
                        Today
                    </button>
                </div>
                <h2 id="currentMonth">January 2024</h2>
                <div class="nav-buttons">
                    <button class="btn btn-outline-primary" id="nextMonth">
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Calendar -->
            <div class="calendar-container">
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
            </div>
        </div>

        <!-- Map View -->
        <div id="mapContainer" style="display: none;">
            <!-- Map Date Filter -->
            <div class="map-filter-controls">
                <label for="dateFilter">
                    <i class="fas fa-calendar-alt me-1"></i>
                    Filter by Date:
                </label>
                <input type="date" id="dateFilter" class="form-control">
                <button id="clearDateFilter" class="btn btn-outline-secondary">
                    <i class="fas fa-times me-1"></i>
                    Clear Filter
                </button>
            </div>
            
            <div class="map-container">
                <h3 class="mb-3">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    Library Locations
                </h3>
                <div id="map">
                    <!-- Current location button -->
                    <div class="location-controls">
                        <button id="locationBtn" class="location-btn" title="Find my location">
                            <i class="fas fa-location-arrow"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Programs View -->
        <div id="newProgramsContainer" style="display: none;">
            <div class="new-programs-header mb-4">
                <div class="new-programs-header-top">
                    <h2 class="mb-0">
                        <i class="fas fa-star me-2"></i>
                        Newly Created Programs
                    </h2>
                    <div class="new-programs-timeframe">
                        <label for="daysSelector" class="mb-0">
                            <i class="fas fa-calendar-day me-1" aria-hidden="true"></i>
                            Show programs from last
                        </label>
                        <select id="daysSelector" class="form-select" aria-label="Filter new programs by days">
                            <option value="1">1 day</option>
                            <option value="4">4 days</option>
                            <option value="7">7 days</option>
                            <option value="14">14 days</option>
                            <option value="21">21 days</option>
                            <option value="28" selected>28 days</option>
                        </select>
                    </div>
                </div>
                <p class="new-programs-description text-muted mt-2 mb-0">
                    Programs created or updated in the selected time period. Tap a card to view the program details instantly.
                </p>
            </div>
            
            <div id="newProgramsLoading" class="text-center py-5" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading new programs...</p>
            </div>
            
            <div id="newProgramsError" class="alert alert-danger" style="display: none;"></div>
            
            <div id="newProgramsList" class="new-programs-list">
                <!-- New programs will be displayed here -->
            </div>
        </div>
    </main>

    <!-- Day Events Modal -->
    <div class="modal fade day-events-modal" id="dayEventsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dayEventsModalTitle">Programs for Selected Day</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="dayEventsModalBody">
                    <!-- Day events will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Program Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="eventModalBody">
                    <!-- Event details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade contact-modal" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">
                        <i class="fas fa-envelope me-2"></i>
                        Share Your Feedback
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-4">Have a suggestion for improvement? We'd love to hear from you!</p>
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Your Name <small class="text-muted">(optional)</small></label>
                            <input type="text" class="form-control" id="contactName" name="name" minlength="2" maxlength="100" placeholder="Enter your name (optional)">
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Your Email <small class="text-muted">(optional)</small></label>
                            <input type="email" class="form-control" id="contactEmail" name="email" placeholder="your.email@example.com (optional)">
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label">Subject</label>
                            <select class="form-select" id="contactSubject" name="subject">
                                <option value="Feature Request">Feature Request</option>
                                <option value="Bug Report">Bug Report</option>
                                <option value="Improvement Suggestion">Improvement Suggestion</option>
                                <option value="General Feedback">General Feedback</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Your Message <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="contactMessage" name="message" required minlength="10" maxlength="2000" rows="5" placeholder="Please describe your suggestion or feedback in detail..."></textarea>
                            <small class="form-text text-muted">
                                <span id="charCount">0</span>/2000 characters
                            </small>
                        </div>
                        <div id="contactFormAlert" class="alert d-none" role="alert"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="contactForm" class="btn btn-primary btn-submit" id="contactSubmitBtn">
                        <i class="fas fa-paper-plane me-2"></i>
                        Send Feedback
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light mt-5 py-4" role="contentinfo">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h3>Toronto Public Library Programs Calendar</h3>
                    <p>Discover and explore free programs, events, and activities at Toronto Public Library branches across the city.</p>
                    <p><a href="https://www.torontopubliclibrary.ca" target="_blank" rel="noopener">Visit Toronto Public Library</a></p>
                </div>
                <div class="col-md-6">
                    <h4>Quick Links</h4>
                    <ul class="list-unstyled">
                        <li><a href="#" onclick="showCalendarView(); return false;">Calendar View</a></li>
                        <li><a href="#" onclick="showMapView(); return false;">Map View</a></li>
                        <li><a href="#" onclick="showNewProgramsView(); return false;">New Programs</a></li>
                        <li><a href="/health" target="_blank">API Health Check</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- External JavaScript -->
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script defer src="/js/app.js"></script>
</body>
</html>